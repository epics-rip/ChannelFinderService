
sudo: required

jdk:
  - oraclejdk8

addons:
  apt:
    packages:
      - python-nose

before_install:
  - curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.deb && sudo dpkg -i --force-confnew elasticsearch-6.2.4.deb

before_script:
  - sleep 10
  - 'echo "script.inline: true" | sudo tee -a /etc/elasticsearch/elasticsearch.yml'
  - 'echo "script.inline: true" | sudo tee -a /etc/elasticsearch/indexed.yml'
  - sudo /etc/init.d/elasticsearch start
  - sleep 25
  - curl -XGET 'http://localhost:9200/_cluster/health?pretty'
  - chmod a+x channelfinder/src/main/resources/mapping_definitions.sh
  
script:
  - channelfinder/src/main/resources/mapping_definitions.sh
  - mvn clean verify -fchannelfinder/pom.xml

after_script:
  - sudo /etc/init.d/elasticsearch stop
  
after_failure:
  -  find . -type f -name "*.log" -print0 -exec cat {} \;
